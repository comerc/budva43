# Сопоставление DAO и DTO

deprecated - отказались от классического DAO&DTO для упрощения, см. [Архитектура v2](./ARCHITECTURE_V2.md)

**DAO (Data Access Objects) = Entity**
- Основные бизнес-сущности с бизнес-логикой
- Отражают ключевые концепции предметной области
- Содержат бизнес-правила, инвариантные к изменениям во внешних слоях (не зависят от деталей реализации хранения или представления)
- Используются внутри сервисного слоя
- Примеры:
    - `Message` - сообщение Telegram с бизнес-логикой
    - `Chat` - чат Telegram с бизнес-правилами
    - `Forward` - правила пересылки сообщений

**DTO (Data Transfer Objects) = Model**
- Структуры данных для передачи между слоями
- Не содержат бизнес-логики
- Могут быть адаптированы под конкретные случаи использования
- Могут содержать подмножество полей DAO или агрегировать несколько DAO
- Используются для взаимодействия с внешними системами или между слоями
- Примеры:
    - `MessageDTO` - для передачи данных сообщения между слоями
    - `ConfigDTO` - для загрузки конфигурации из YAML
    - `WebResponse` - для формирования ответов API

## Примеры взаимодействия

1. Получение сообщения из Telegram:
    - `TelegramRepo` получает сырые данные от TDLib
    - Преобразует их в `MessageDTO`
    - Передает в `MessageService`
    - `MessageService` преобразует `MessageDTO` в `Message` (Entity)
    - Выполняет бизнес-логику с использованием сущности `Message`

2. Применение правил пересылки:
    - `ConfigRepo` загружает конфигурацию
    - Преобразует данные конфигурации в `ForwardRuleDTO`
    - `ForwardService` преобразует `ForwardRuleDTO` в `ForwardRule` (Entity)
    - Применяет правила пересылки к сообщениям

3. Генерация отчета:
    - `ReportController` получает запрос в виде `ReportRequestDTO`
    - Передает его в `ReportService`
    - `ReportService` генерирует отчет с использованием бизнес-сущностей
    - Возвращает результат в виде `ReportResponseDTO`

Этот подход позволит четко разделить бизнес-логику и детали реализации, что упростит тестирование и дальнейшее развитие проекта.

---

[Луковичная архитектура в компоновке backend-приложения и куда в итоге класть маперы](https://habr.com/ru/articles/672328/)