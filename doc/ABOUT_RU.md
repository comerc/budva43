# О проекте budva43

## Описание

**budva43** — это интеллектуальная система автоматической пересылки сообщений в Telegram, написанная на Go. Проект представляет собой enterprise-уровневое решение, реализующее принципы UNIX-way и clean architecture для создания тематических дайджестов из сообщений различных каналов и групп.

## Основная функциональность

### Автоматическая пересылка сообщений
- **Пересылка (forward)** — отправляет сообщения с сохранением оригинального авторства
- **Копирование (send copy)** — создает копии сообщений без указания первоначального источника
- **Поддержка медиа-альбомов** — обработка групповых изображений и файлов

### Система фильтрации
- **Фильтры исключения** — регулярные выражения для блокировки нежелательного контента
- **Фильтры включения** — правила для пропуска только релевантных сообщений
- **Подстроковые фильтры** — точная фильтрация по подстрокам с использованием групп регулярных выражений
- **Автоответы** — автоматические ответы на сообщения с клавиатурой
- **Специальные чаты** — автоматическая отправка отфильтрованных сообщений в check/other каналы

### Трансформация контента
- **Замена ссылок** — автоматическая замена ссылок на собственные сообщения в целевых чатах
- **Удаление внешних ссылок** — очистка ссылок на внешние источники
- **Замена фрагментов текста** — настраиваемое преобразование текста для разных получателей
- **Добавление подписей источников** — указание оригинального источника сообщения
- **Генерация ссылок на источники** — автоматическое добавление ссылок на оригинальные сообщения

### Управление жизненным циклом сообщений
- **Copy Once** — однократная отправка без синхронизации при редактировании
- **Indelible** — защита сообщений от удаления при удалении оригинала
- **Синхронизация редактирования** — автоматическое обновление скопированных сообщений при изменении оригинала
- **Синхронизация удаления** — удаление копий при удалении исходного сообщения

### Дополнительные возможности
- **Rate limiting** — контроль скорости отправки для предотвращения блокировок
- **Обработка системных сообщений** — автоматическое удаление служебных уведомлений

## Архитектура

### Микросервисная структура
Проект разделен на два основных сервиса:

#### Engine (cmd/engine)
- **Назначение**: выполнение пересылки сообщений
- **Ограничения**: запрещена отправка новых сообщений в исходящие чаты
- **Компоненты**: обработчики обновлений Telegram, сервисы пересылки и фильтрации

#### Facade (cmd/facade)  
- **Назначение**: предоставление API (GraphQL, gRPC, REST)
- **Возможности**: полный доступ к функциям отправки сообщений
- **Интерфейсы**: веб-интерфейс, gRPC API, терминальный интерфейс

### Слоистая архитектура

```
Transport Layer    → HTTP, gRPC, Terminal, Telegram Bot API
Service Layer      → Бизнес-логика, обработка правил пересылки
Repository Layer   → TDLib, Storage, Queue
Domain Layer       → Модели данных, правила пересылки
```

### Паттерны проектирования
- **Clean Architecture** — четкое разделение слоев ответственности
- **Dependency Injection** — самописная система внедрения зависимостей
- **Repository Pattern** — абстракция доступа к данным
- **Observer Pattern** — обработка обновлений от Telegram

## Технологический стек

### Core Technologies
- **Go 1.24** — основной язык разработки с поддержкой generics
- **TDLib** — официальная библиотека Telegram для клиентских приложений
- **BadgerDB** — встроенная NoSQL база данных

### API & Transport
- **gRPC** — высокопроизводительный API для интеграций
- **GraphQL** — гибкий API для веб-клиентов  
- **REST** — классический HTTP API
- **Telegram Client API** — прямое взаимодействие с Telegram
- **Terminal Interface** — интерактивный терминальный интерфейс

### Development & Testing
- **Docker & DevContainers** — контейнеризация разработки
- **Testcontainers** — интеграционное тестирование (включая Redis для проверки подключения)
- **Mockery** — генерация мок-объектов
- **Godog (BDD)** — behavior-driven тестирование
- **GitHub Actions CI** — автоматизированная непрерывная интеграция

### Monitoring & Observability
- **Structured Logging** — структурированное логирование с slog
- **Grafana + Loki** — централизованные логи и мониторинг
- **pplog** — human-readable JSON логирование для разработки
- **spylog** — перехват логов в тестах

### Build & Development Tools
- **Task** — альтернатива Make для автоматизации задач
- **golangci-lint** — комплексная проверка качества кода
- **Самописные линтеры** — "error-log-or-return" и "unused-interface-methods"
- **protobuf** — генерация gRPC интерфейсов
- **jq** — просмотр логов с фильтрацией в реальном времени
- **EditorConfig** — единообразие настроек редакторов

## Принципы разработки

### Архитектурные принципы
- **SOLID** — применение всех пяти принципов ООП
- **DRY** — избежание дублирования кода без фанатизма
- **KISS** — предпочтение простых решений сложным
- **YAGNI** — реализация только необходимой функциональности

### Go-специфичные подходы
- **CSP (Communicating Sequential Processes)** — использование каналов вместо мьютексов
- **Interface Segregation** — локальные интерфейсы в потребляющих модулях
- **Accept interfaces, return structs** — идиоматичная работа с интерфейсами
- **Early Return** — уменьшение вложенности кода
- **Table-driven tests** — структурированное тестирование

### Соглашения по обработке ошибок
- **Structured Errors** — структурированные ошибки с автоматическим стеком вызовов
- **Log or Return** — либо логируем ошибку, либо возвращаем выше
- **Минимальное обертывание** — обертка ошибок только при добавлении контекста

## Конфигурация

### Иерархия настроек
```
defaultConfig() → config.yml → .env
```

### Типы конфигураций
- **Статическая конфигурация** — базовые настройки приложения
- **Динамическая конфигурация** — правила пересылки с hot-reload
- **Секретные данные** — API ключи и токены через переменные окружения

### Примеры настроек пересылки
```yaml
forward_rules:
  rule1:
    from: 1001234567890
    to: [1009876543210, 1001111111111]
    send_copy: true
    exclude: "EXCLUDE|spam"
    include: "IMPORTANT|urgent"
    copy_once: false
    indelible: true
```

## Тестирование

### Многоуровневое тестирование
- **Unit Tests** — изолированное тестирование компонентов с моками
- **Integration Tests** — тестирование взаимодействия компонентов
- **E2E Tests** — полные сценарии пользователей через gRPC API
- **BDD Tests** — описание поведения на естественном языке
- **Snapshot Testing** — тестирование с эталонными снимками

### Специальные техники
- **Synctest** — тестирование времени и конкурентности
- **Call-driven Tests** — табличные тесты с функциями подготовки
- **Spy Logging** — перехват и проверка логов в тестах

### Покрытие тестами
- **Codecov.io интеграция** — автоматическое отслеживание покрытия кода
- **Покрытие для интеграционных тестов** — специальные инструменты
- **Функциональное покрытие** — все ключевые сценарии использования
- **Техническое покрытие** — внутренние функции и edge cases
- **BDD сценарии** — пользовательские истории и бизнес-правила

## Развертывание и эксплуатация

### Варианты запуска
- **Локальная разработка** — прямая установка TDLib на хост-машину
- **DevContainer** — полностью изолированная среда разработки
- **Production** — контейнеризированное развертывание

### Мониторинг и отладка
- **Structured Logs** — JSON логи для машинной обработки
- **Human-readable Logs** — pplog для разработки
- **Health Checks** — проверки состояния сервисов
- **Graceful Shutdown** — корректное завершение работы

### Интеграции
- **Telegram Client** — полноценный клиент с авторизацией
- **External APIs** — интеграция через GraphQL, gRPC, REST
- **Message Queues** — асинхронная обработка сообщений

## Вклад в развитие

### Философия проекта
Budva43 позиционируется как "мой лучший учебный проект для применения технологий — от MVP до Enterprise уровня". Проект демонстрирует современные подходы к разработке на Go, включая новейшие возможности языка и лучшие практики индустрии.

### Уникальные особенности
- **Экспериментальные подходы** — использование cutting-edge возможностей Go
- **Комплексное тестирование** — полный спектр техник тестирования
- **Production-ready качество** — готовность к промышленной эксплуатации
- **Обучающий характер** — богатая документация и примеры

Проект активно развивается и служит демонстрацией возможностей современного Go в enterprise разработке. 