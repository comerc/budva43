# budva43プロジェクトについて

## 概要

**budva43**は、Go言語で書かれたインテリジェントなTelegramメッセージ自動転送システムです。このプロジェクトは、UNIX-wayの原則とクリーンアーキテクチャを実装したエンタープライズレベルのソリューションで、様々なチャンネルやグループからのメッセージからテーマ別ダイジェストを作成します。

## 主要機能

### 自動メッセージ転送
- **転送（Forward）** — 元の作者を保持してメッセージを送信
- **コピー送信（Send Copy）** — 元のソースを示さずにメッセージのコピーを作成
- **メディアアルバムサポート** — グループ化された画像とファイルの処理

### フィルタリングシステム
- **除外フィルター** — 不要なコンテンツをブロックする正規表現
- **包含フィルター** — 関連メッセージのみを通すルール
- **サブストリングフィルター** — 正規表現グループを使用した精密なサブストリングフィルタリング
- **自動返信** — キーボード付きメッセージへの自動応答
- **特別チャット** — フィルターされたメッセージのcheck/otherチャンネルへの自動送信

### コンテンツ変換
- **リンク置換** — ターゲットチャット内の自分のメッセージへのリンクの自動置換
- **外部リンク削除** — 外部ソースへのリンクのクリーニング
- **テキスト断片置換** — 異なる受信者向けのカスタマイズ可能なテキスト変換
- **ソース署名** — 元のメッセージソースの表示
- **ソースリンク生成** — 元のメッセージへのリンクの自動追加

### メッセージライフサイクル管理
- **一回コピー（Copy Once）** — 編集時の同期なしの単発送信
- **削除不可（Indelible）** — 元が削除された時のメッセージ削除からの保護
- **編集同期** — 元が変更された時のコピーメッセージの自動更新
- **削除同期** — ソースメッセージ削除時のコピー削除

### 追加機能
- **レート制限** — ブロックを防ぐための送信速度制御
- **システムメッセージ処理** — サービス通知の自動削除

## アーキテクチャ

### マイクロサービス構造
プロジェクトは2つの主要サービスに分かれています：

#### エンジン（cmd/engine）
- **目的**：メッセージ転送の実行
- **制限**：送信チャットへの新しいメッセージ送信は禁止
- **コンポーネント**：Telegram更新ハンドラー、転送・フィルタリングサービス

#### ファサード（cmd/facade）  
- **目的**：API提供（GraphQL、gRPC、REST）
- **機能**：メッセージ送信機能への完全アクセス
- **インターフェース**：Webインターフェース、gRPC API、ターミナルインターフェース

### レイヤードアーキテクチャ

```
Transport Layer    → HTTP、gRPC、Terminal、Telegram Bot API
Service Layer      → ビジネスロジック、転送ルール処理
Repository Layer   → TDLib、Storage、Queue
Domain Layer       → データモデル、転送ルール
```

### デザインパターン
- **クリーンアーキテクチャ** — 責任レイヤーの明確な分離
- **依存性注入** — カスタム依存性注入システム
- **リポジトリパターン** — データアクセス抽象化
- **オブザーバーパターン** — Telegram更新処理

## 技術スタック

### コア技術
- **Go 1.24** — ジェネリクスサポート付きメイン開発言語
- **TDLib** — クライアントアプリケーション用公式Telegramライブラリ
- **BadgerDB** — 組み込みNoSQLデータベース

### APIとトランスポート
- **gRPC** — 統合用高性能API
- **GraphQL** — Webクライアント用柔軟API  
- **REST** — クラシックHTTP API
- **Telegram Client API** — Telegramとの直接やり取り
- **ターミナルインターフェース** — インタラクティブターミナルインターフェース

### 開発とテスト
- **DockerとDevContainers** — 開発コンテナ化
- **Testcontainers** — 統合テスト（Redis接続テストを含む）
- **Mockery** — モックオブジェクト生成
- **Godog（BDD）** — 振る舞い駆動テスト
- **GitHub Actions CI** — 自動継続的インテグレーション

### 監視と可観測性
- **構造化ログ** — slogを使用した構造化ログ記録
- **Grafana + Loki** — 集中ログと監視
- **pplog** — 開発用人間可読JSONログ
- **spylog** — テスト内ログ傍受

### ビルドと開発ツール
- **Task** — タスク自動化のためのMake代替
- **golangci-lint** — 包括的コード品質チェック
- **カスタムリンター** — "error-log-or-return"と"unused-interface-methods"
- **protobuf** — gRPCインターフェース生成
- **jq** — フィルタリング付きリアルタイムログ表示
- **EditorConfig** — エディター設定の一貫性

## 開発原則

### アーキテクチャ原則
- **SOLID** — すべての5つのOOP原則の適用
- **DRY** — 狂信的でないコード重複の回避
- **KISS** — 複雑なソリューションより単純なソリューションを優先
- **YAGNI** — 必要な機能のみの実装

### Go固有のアプローチ
- **CSP（通信順次プロセス）** — ミューテックスの代わりにチャンネル使用
- **インターフェース分離** — 消費モジュール内のローカルインターフェース
- **インターフェースを受け入れ、構造体を返す** — インターフェースでの慣用的作業
- **早期リターン** — コードネストの削減
- **テーブル駆動テスト** — 構造化テスト

### エラーハンドリング規約
- **構造化エラー** — 自動コールスタック付き構造化エラー
- **ログか返却** — エラーをログするか上位に返すかの選択
- **最小ラッピング** — コンテキスト追加時のみエラーラッピング

## 設定

### 設定階層
```
defaultConfig() → config.yml → .env
```

### 設定タイプ
- **静的設定** — 基本アプリケーション設定
- **動的設定** — ホットリロード付き転送ルール
- **秘密データ** — 環境変数によるAPIキーとトークン

### 転送設定例
```yaml
forward_rules:
  rule1:
    from: 1001234567890
    to: [1009876543210, 1001111111111]
    send_copy: true
    exclude: "EXCLUDE|spam"
    include: "IMPORTANT|urgent"
    copy_once: false
    indelible: true
```

## テスト

### 多層テスト
- **ユニットテスト** — モック付きの分離コンポーネントテスト
- **統合テスト** — コンポーネント相互作用テスト
- **E2Eテスト** — gRPC API経由の完全ユーザーシナリオ
- **BDDテスト** — 自然言語での振る舞い記述
- **スナップショットテスト** — 参照スナップショット付きテスト

### 特殊技術
- **同期テスト** — 時間と並行性テスト
- **コール駆動テスト** — 準備関数付きテーブルテスト
- **スパイログ** — テスト内ログ傍受と検証

### テストカバレッジ
- **Codecov.io統合** — 自動コードカバレッジ追跡
- **統合テストカバレッジ** — 専用ツール
- **機能カバレッジ** — すべての主要使用シナリオ
- **技術カバレッジ** — 内部関数とエッジケース
- **BDDシナリオ** — ユーザーストーリーとビジネスルール

## デプロイと運用

### 起動オプション
- **ローカル開発** — ホストマシンへのTDLib直接インストール
- **DevContainer** — 完全に分離された開発環境
- **本番** — コンテナ化デプロイ

### 監視とデバッグ
- **構造化ログ** — マシン処理用JSONログ
- **人間可読ログ** — 開発用pplog
- **ヘルスチェック** — サービス状態チェック
- **グレースフルシャットダウン** — 正しい作業終了

### 統合
- **Telegramクライアント** — 認証付きフル機能クライアント
- **外部API** — GraphQL、gRPC、REST経由の統合
- **メッセージキュー** — 非同期メッセージ処理

## 開発への貢献

### プロジェクト哲学
Budva43は「技術適用のための私の最高の学習プロジェクト — MVPからエンタープライズレベルまで」として位置づけられています。このプロジェクトは、言語の最新機能と業界のベストプラクティスを含む、現代のGo開発アプローチを実証しています。

### ユニークな特徴
- **実験的アプローチ** — 最先端のGo機能の使用
- **包括的テスト** — テスト技術の全スペクトラム
- **本番レディ品質** — 産業使用への準備
- **教育的性格** — 豊富なドキュメントと例

プロジェクトは積極的に開発されており、エンタープライズ開発における現代Goの能力のデモンストレーションとして機能しています。 